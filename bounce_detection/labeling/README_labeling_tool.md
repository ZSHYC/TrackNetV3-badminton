# åŠè‡ªåŠ¨æ ‡æ³¨å·¥å…·

**Semi-automatic Labeling Tool for Bounce Detection**

åŸºäº Phase 1 è§„åˆ™æ£€æµ‹ç»“æœçš„äº¤äº’å¼æ ‡æ³¨å·¥å…·ï¼Œç”¨äºç”Ÿæˆ BounceNet è®­ç»ƒæ•°æ®ã€‚

> ğŸ“– ç›¸å…³æ–‡æ¡£:
> - [æ¨¡å—æ€»è§ˆ](../README.md)
> - [Phase 1 è§„åˆ™æ£€æµ‹](../README_phase1_rules.md)
> - [Phase 2 BounceNet](../README_phase2_bouncenet.md)

---

## ğŸ“‹ ç›®å½•

- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
- [ç•Œé¢è¯´æ˜](#ç•Œé¢è¯´æ˜)
- [å¿«æ·é”®](#å¿«æ·é”®)
- [æ•°æ®æ ¼å¼](#æ•°æ®æ ¼å¼)
- [æ‰¹é‡æ ‡æ³¨](#æ‰¹é‡æ ‡æ³¨)
- [å¯¼å‡ºè®­ç»ƒæ•°æ®](#å¯¼å‡ºè®­ç»ƒæ•°æ®)
- [API å‚è€ƒ](#api-å‚è€ƒ)

---

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

- âœ… **Phase 1 é¢„å¡«å……**: è‡ªåŠ¨è¿è¡Œè§„åˆ™æ£€æµ‹ï¼Œé¢„å¡«å……å€™é€‰äº‹ä»¶
- âœ… **è§†é¢‘å¸§æµè§ˆ**: æ”¯æŒè§†é¢‘å¸§å’Œè½¨è¿¹åŒæ­¥æ˜¾ç¤º
- âœ… **äº‹ä»¶ç¼–è¾‘**: ç¡®è®¤/åˆ é™¤/ä¿®æ”¹/æ·»åŠ äº‹ä»¶
- âœ… **å®æ—¶ç»Ÿè®¡**: æ˜¾ç¤ºæ ‡æ³¨è¿›åº¦å’Œäº‹ä»¶åˆ†å¸ƒ
- âœ… **è‡ªåŠ¨ä¿å­˜**: JSON æ ¼å¼æ ‡æ³¨æ–‡ä»¶
- âœ… **æ‰¹é‡å¤„ç†**: æ”¯æŒæ•´ä¸ª match ç›®å½•çš„è¿ç»­æ ‡æ³¨
- âœ… **æ•°æ®å¯¼å‡º**: å¯¼å‡ºä¸º CSV è®­ç»ƒæ ¼å¼
- âœ… **ç°ä»£åŒ–ç•Œé¢**: æ·±è‰²ä¸»é¢˜ + æ¸…æ™°çš„è§†è§‰åé¦ˆ

### äº‹ä»¶ç±»å‹

| ç±»å‹ | æ ‡è¯† | ç¬¦å· | é¢œè‰² | å¿«æ·é”® |
|------|------|------|------|--------|
| è½åœ°ç‚¹ | `landing` | â˜… | ğŸ”´ çŠç‘šçº¢ | L |
| å‡»çƒç‚¹ | `hit` | â—† | ğŸ”µ é’ç»¿è‰² | H |
| å‡ºç”»é¢ | `out_of_frame` | âœ• | â¬œ ç°è‰² | O |
| å…¶ä»– | `other` | â–  | ğŸŸ¡ æ©™é»„è‰² | N |

---

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
pip install numpy pandas matplotlib opencv-python
```

### æ ‡æ³¨å•ä¸ªæ–‡ä»¶

```bash
# åŸºæœ¬ç”¨æ³•ï¼ˆè‡ªåŠ¨æŸ¥æ‰¾å¯¹åº”è§†é¢‘ï¼‰
python labeling_launcher.py --csv data/test/match1/csv/1_05_02_ball.csv

# æŒ‡å®šè§†é¢‘æ–‡ä»¶
python labeling_launcher.py --csv data/test/match1/csv/1_05_02_ball.csv \
                            --video data/test/match1/video/1_05_02.mp4

# åŠ è½½å·²æœ‰æ ‡æ³¨ç»§ç»­ç¼–è¾‘
python labeling_launcher.py --csv data/test/match1/csv/1_05_02_ball.csv \
                            --labels data/test/match1/labels/1_05_02_labels.json
```

### æ‰¹é‡æ ‡æ³¨

```bash
# æ ‡æ³¨æ•´ä¸ª match ç›®å½•
python labeling_launcher.py --match_dir data/test/match1
```

---

## ä½¿ç”¨æŒ‡å—

### å·¥ä½œæµç¨‹

```
1. å¯åŠ¨å·¥å…·
   â””â”€â”€ è‡ªåŠ¨åŠ è½½ CSV è½¨è¿¹
   â””â”€â”€ è‡ªåŠ¨æŸ¥æ‰¾å¯¹åº”è§†é¢‘
   â””â”€â”€ è‡ªåŠ¨è¿è¡Œ Phase 1 æ£€æµ‹é¢„å¡«å……
   
2. æµè§ˆå€™é€‰äº‹ä»¶
   â””â”€â”€ â†‘/W è·³è½¬åˆ°ä¸Šä¸€ä¸ªäº‹ä»¶
   â””â”€â”€ â†“ è·³è½¬åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶
   â””â”€â”€ â†/A ä¸Šä¸€å¸§
   â””â”€â”€ â†’/D ä¸‹ä¸€å¸§
   
3. ç¡®è®¤/ä¿®æ­£äº‹ä»¶
   â””â”€â”€ Y ç¡®è®¤å½“å‰äº‹ä»¶
   â””â”€â”€ Delete åˆ é™¤è¯¯æ£€äº‹ä»¶
   â””â”€â”€ L/H/O ä¿®æ”¹äº‹ä»¶ç±»å‹
   
4. è¡¥å……é—æ¼äº‹ä»¶
   â””â”€â”€ å¯¼èˆªåˆ°é—æ¼çš„å¸§
   â””â”€â”€ N æ·»åŠ æ–°äº‹ä»¶ï¼ˆé»˜è®¤ä¸ºè½åœ°ï¼‰
   â””â”€â”€ L/H/O è®¾ç½®ç±»å‹
   
5. ä¿å­˜æ ‡æ³¨
   â””â”€â”€ S / Ctrl+S ä¿å­˜
   â””â”€â”€ Q / Esc é€€å‡º
```

### æ ‡æ³¨æ ‡å‡†

#### Landing (è½åœ°ç‚¹) â˜…
- çƒè½åœ°ååœæ­¢æˆ–æ¶ˆå¤±
- å…¸å‹ç‰¹å¾ï¼šé€Ÿåº¦éª¤é™è‡³æ¥è¿‘é›¶

#### Hit (å‡»çƒç‚¹) â—†
- çƒè¢«çƒæ‹å‡»ä¸­çš„ç¬é—´
- å…¸å‹ç‰¹å¾ï¼šé€Ÿåº¦æ–¹å‘çªç„¶åè½¬ï¼Œé€Ÿåº¦å¤§å°ä¿æŒè¾ƒé«˜

#### Out-of-frame (å‡ºç”»é¢) âœ•
- çƒé£å‡ºç”»é¢è¾¹ç¼˜
- å…¸å‹ä½ç½®ï¼šç”»é¢é¡¶éƒ¨/åº•éƒ¨/ä¸¤ä¾§è¾¹ç¼˜

---

## ç•Œé¢è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ğŸ¸ ç¾½æ¯›çƒè½ç‚¹æ£€æµ‹æ ‡æ³¨å·¥å…· v2.0                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       â”‚            â”‚            â”‚                       â”‚
â”‚    è§†é¢‘å¸§ / è½¨è¿¹å›¾     â”‚  ä¿¡æ¯é¢æ¿   â”‚  äº‹ä»¶åˆ—è¡¨  â”‚    å¿«æ·é”®é¢æ¿         â”‚
â”‚                       â”‚            â”‚            â”‚                       â”‚
â”‚  - å½“å‰å¸§ç”»é¢          â”‚ â•”â•â•â•â•â•â•â•â•—  â”‚ â•”â•â•â•â•â•â•â•â•—  â”‚  â•”â•â•â•â•â•â•â•â•—            â”‚
â”‚  - è½¨è¿¹çº¿ï¼ˆæ¸å˜ç»¿ï¼‰    â”‚ â•‘å¸§ä¿¡æ¯ â•‘  â”‚ â•‘äº‹ä»¶   â•‘  â”‚  â•‘å¿«æ·é”® â•‘            â”‚
â”‚  - çƒä½ç½®ï¼ˆé»„è‰²å…‰æ™•ï¼‰  â”‚ â• â•â•â•â•â•â•â•â•£  â”‚ â• â•â•â•â•â•â•â•â•£  â”‚  â• â•â•â•â•â•â•â•â•£            â”‚
â”‚  - äº‹ä»¶æ ‡è®°           â”‚ â•‘å½“å‰   â•‘  â”‚ â•‘åˆ—è¡¨   â•‘  â”‚  â•‘å¯¼èˆª   â•‘            â”‚
â”‚    â˜… è½åœ° â—† å‡»æ‰“      â”‚ â•‘äº‹ä»¶   â•‘  â”‚ â•‘       â•‘  â”‚  â•‘ç¼–è¾‘   â•‘            â”‚
â”‚    âœ• å‡ºç”» â–  å…¶ä»–      â”‚ â• â•â•â•â•â•â•â•â•£  â”‚ â•‘ â–¶å½“å‰  â•‘  â”‚  â•‘ç³»ç»Ÿ   â•‘            â”‚
â”‚                       â”‚ â•‘ç»Ÿè®¡   â•‘  â”‚ â•šâ•â•â•â•â•â•â•â•  â”‚  â•šâ•â•â•â•â•â•â•â•            â”‚
â”‚                       â”‚ â•šâ•â•â•â•â•â•â•â•  â”‚            â”‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚     ğŸ“ˆ Y åæ ‡å˜åŒ–         â”‚      ğŸš€ è¿åŠ¨é€Ÿåº¦      â”‚      æŒ‰é’®åŒºåŸŸ        â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        çŠ¶æ€æ : å‡†å¤‡å°±ç»ª | æŒ‰ Q é€€å‡ºï¼ŒS ä¿å­˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å›¾æ ‡è¯´æ˜

| æ ‡è®° | å«ä¹‰ |
|------|------|
| ğŸŸ¡ é»„è‰²åœ†åœˆ+å…‰æ™• | å½“å‰å¸§çƒçš„ä½ç½® |
| â˜… çº¢è‰²æ˜Ÿå· | è½åœ°ç‚¹äº‹ä»¶ |
| â—† é’ç»¿è±å½¢ | å‡»çƒç‚¹äº‹ä»¶ |
| âœ• ç°è‰²å‰å· | å‡ºç”»é¢äº‹ä»¶ |
| â–  æ©™é»„æ–¹å— | å…¶ä»–äº‹ä»¶ |
| å®å¿ƒå›¾æ ‡ | å·²ç¡®è®¤äº‹ä»¶ |
| ç©ºå¿ƒå›¾æ ‡ | æœªç¡®è®¤äº‹ä»¶ |
| â–¶ ç®­å¤´æŒ‡ç¤º | å½“å‰é€‰ä¸­çš„äº‹ä»¶ |

---

## å¿«æ·é”®

### å¯¼èˆª

| å¿«æ·é”® | åŠŸèƒ½ | è¯´æ˜ |
|--------|------|------|
| `â†` / `A` | ä¸Šä¸€å¸§ | åé€€ä¸€å¸§ |
| `â†’` / `D` | ä¸‹ä¸€å¸§ | å‰è¿›ä¸€å¸§ |
| `â†‘` / `W` | ä¸Šä¸€äº‹ä»¶ | è·³è½¬åˆ°ä¸Šä¸€ä¸ªæ£€æµ‹äº‹ä»¶ |
| `â†“` | ä¸‹ä¸€äº‹ä»¶ | è·³è½¬åˆ°ä¸‹ä¸€ä¸ªæ£€æµ‹äº‹ä»¶ |
| `Home` | ç¬¬ä¸€å¸§ | è·³è½¬åˆ°è§†é¢‘å¼€å¤´ |
| `End` | æœ€åä¸€å¸§ | è·³è½¬åˆ°è§†é¢‘ç»“å°¾ |
| `PageUp` | åé€€30å¸§ | å¿«é€Ÿåé€€ |
| `PageDown` | å‰è¿›30å¸§ | å¿«é€Ÿå‰è¿› |

### äº‹ä»¶ç¼–è¾‘

| å¿«æ·é”® | åŠŸèƒ½ | è¯´æ˜ |
|--------|------|------|
| `Y` | ç¡®è®¤äº‹ä»¶ | å°†å½“å‰äº‹ä»¶æ ‡è®°ä¸ºå·²ç¡®è®¤ |
| `Delete` / `Backspace` | åˆ é™¤äº‹ä»¶ | åˆ é™¤å½“å‰å¸§çš„äº‹ä»¶ |
| `L` | è½åœ°ç‚¹ | è®¾ç½®/æ·»åŠ ä¸º Landing |
| `H` | å‡»çƒç‚¹ | è®¾ç½®/æ·»åŠ ä¸º Hit |
| `O` | å‡ºç”»é¢ | è®¾ç½®/æ·»åŠ ä¸º Out-of-frame |
| `N` | æ–°å»ºäº‹ä»¶ | åœ¨å½“å‰å¸§æ·»åŠ äº‹ä»¶ï¼ˆé»˜è®¤è½åœ°ï¼‰ |

### ç³»ç»Ÿ

| å¿«æ·é”® | åŠŸèƒ½ | è¯´æ˜ |
|--------|------|------|
| `S` / `Ctrl+S` | ä¿å­˜ | ä¿å­˜æ ‡æ³¨åˆ° JSON æ–‡ä»¶ |
| `Q` / `Esc` | é€€å‡º | é€€å‡ºç¨‹åºï¼ˆæç¤ºä¿å­˜ï¼‰ |

> âš ï¸ **æ³¨æ„**: `D` é”®ç”¨äºå¯¼èˆªï¼ˆä¸‹ä¸€å¸§ï¼‰ï¼Œä¸æ˜¯åˆ é™¤ã€‚åˆ é™¤è¯·ä½¿ç”¨ `Delete` æˆ– `Backspace`ã€‚

---

## æ•°æ®æ ¼å¼

### æ ‡æ³¨æ–‡ä»¶ (JSON)

```json
{
  "metadata": {
    "video_path": "data/test/match1/video/1_05_02.mp4",
    "csv_path": "data/test/match1/csv/1_05_02_ball.csv",
    "total_frames": 517,
    "fps": 30,
    "labeled_at": "2026-01-21T15:30:00"
  },
  "events": [
    {
      "frame": 30,
      "x": 481.0,
      "y": 385.0,
      "event_type": "hit",
      "rule": "vy_reversal",
      "confidence": 0.8,
      "confirmed": true,
      "features": {
        "vy_before": -21.0,
        "vy_after": 179.0
      }
    },
    {
      "frame": 516,
      "x": 652.0,
      "y": 698.0,
      "event_type": "landing",
      "rule": "trajectory_end",
      "confidence": 0.7,
      "confirmed": true,
      "features": {}
    }
  ]
}
```

### å¯¼å‡ºæ ¼å¼ (CSV)

```csv
rally,frame,x,y,event_type,confidence
1_05_02,30,481.0,385.0,hit,1.0
1_05_02,72,718.0,436.0,hit,1.0
1_05_02,516,652.0,698.0,landing,1.0
```

---

## æ‰¹é‡æ ‡æ³¨

### æ‰¹é‡æ ‡æ³¨æµç¨‹

```bash
# 1. å¯åŠ¨æ‰¹é‡æ ‡æ³¨
python labeling_launcher.py --match_dir data/test/match1

# 2. è‡ªåŠ¨æ˜¾ç¤ºå¾…æ ‡æ³¨æ–‡ä»¶åˆ—è¡¨
# Found 11 CSV files
# Labeled: 0
# Pending: 11

# 3. é€ä¸ªæ ‡æ³¨
# - æ¯ä¸ªæ–‡ä»¶æ ‡æ³¨å®Œæˆåè‡ªåŠ¨ä¿å­˜
# - è¯¢é—®æ˜¯å¦ç»§ç»­ä¸‹ä¸€ä¸ª

# 4. æ ‡æ³¨ç»“æœä¿å­˜åˆ° data/test/match1/labels/
```

### æŒ‡å®šè¾“å‡ºç›®å½•

```bash
python labeling_launcher.py --match_dir data/test/match1 \
                            --output_dir my_labels/match1
```

---

## å¯¼å‡ºè®­ç»ƒæ•°æ®

### å¯¼å‡ºæ‰€æœ‰å·²ç¡®è®¤äº‹ä»¶

```bash
python labeling_launcher.py --export data/test/match1/labels \
                            --output training_events.csv
```

### æŸ¥çœ‹æ ‡æ³¨ç»Ÿè®¡

```bash
python labeling_launcher.py --stats data/test/match1/labels
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
============================================================
Labeling Statistics
============================================================
Total label files: 11
Total events: 101
Confirmed events: 85
Confirmation rate: 84.2%

By event type:
  hit: 62
  landing: 12
  out_of_frame: 11

By rally:
  1_05_02: 10/13 confirmed
  1_05_03: 8/11 confirmed
  ...
```

---

## API å‚è€ƒ

### LabelingDataManager

```python
from bounce_detection.labeling import LabelingDataManager

# åˆå§‹åŒ–
dm = LabelingDataManager(
    video_path='path/to/video.mp4',  # å¯é€‰
    csv_path='path/to/trajectory.csv',
    label_path='path/to/labels.json'  # å¯é€‰
)

# è®¿é—®æ•°æ®
frame = dm.get_frame(100)           # è·å–ç¬¬ 100 å¸§
x, y, vis = dm.get_trajectory_at_frame(100)  # è·å–è½¨è¿¹ç‚¹

# äº‹ä»¶ç®¡ç†
dm.add_event({'frame': 100, 'event_type': 'hit'})
dm.confirm_event(100)
dm.update_event(100, {'event_type': 'landing'})
dm.remove_event(100)

# ä¿å­˜
dm.save_labels('output.json')

# ç»Ÿè®¡
stats = dm.get_statistics()
```

### LabelingTool

```python
from bounce_detection.labeling import LabelingTool

# åˆå§‹åŒ–å¹¶å¯åŠ¨
tool = LabelingTool(
    csv_path='path/to/trajectory.csv',
    video_path='path/to/video.mp4',  # å¯é€‰
    auto_detect=True  # æ˜¯å¦è‡ªåŠ¨è¿è¡Œ Phase 1
)

# å¯åŠ¨äº¤äº’ç•Œé¢
events = tool.run()
```

### LabelExporter

```python
from bounce_detection.labeling.data_manager import LabelExporter

# å¯¼å‡ºä¸ºè®­ç»ƒ CSV
LabelExporter.to_training_csv(dm, 'output.csv', only_confirmed=True)

# å¯¼å‡ºäº‹ä»¶åˆ—è¡¨
LabelExporter.to_event_list(dm, 'events.csv', only_confirmed=True)
```

---

## æ–‡ä»¶ç»“æ„

```
bounce_detection/labeling/
â”œâ”€â”€ __init__.py              # æ¨¡å—å…¥å£
â”œâ”€â”€ data_manager.py          # æ•°æ®åŠ è½½/ä¿å­˜/ç®¡ç†
â”œâ”€â”€ visualizer.py            # å¯è§†åŒ–ç»„ä»¶
â”œâ”€â”€ labeling_tool.py         # ä¸»æ ‡æ³¨å·¥å…·
â””â”€â”€ README.md                # æœ¬æ–‡æ¡£

labeling_launcher.py         # å¯åŠ¨è„šæœ¬
test_labeling_tool.py        # æµ‹è¯•è„šæœ¬
```

---

## æ›´æ–°æ—¥å¿—

### v0.1.0 (2026-01-21)

- âœ… å®ç° LabelingDataManager æ•°æ®ç®¡ç†
- âœ… å®ç° matplotlib äº¤äº’ç•Œé¢
- âœ… æ”¯æŒ Phase 1 è‡ªåŠ¨é¢„å¡«å……
- âœ… æ”¯æŒé”®ç›˜å¿«æ·é”®æ“ä½œ
- âœ… æ”¯æŒæ‰¹é‡æ ‡æ³¨æ¨¡å¼
- âœ… æ”¯æŒ CSV/JSON å¯¼å‡º

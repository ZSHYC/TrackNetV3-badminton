# 视频导航功能更新说明

## 新增功能 (2026-01-23)

### 1. Match中视频列表管理

标注工具现在可以识别当前match目录中的所有视频，并支持在视频之间快速切换。

**新增函数** (`data_manager.py`):
- `get_match_csv_files(csv_path)` - 获取当前match目录下的所有CSV文件列表
- `get_previous_csv(csv_path)` - 获取上一个视频的CSV文件路径
- `get_next_csv(csv_path)` - 获取下一个视频的CSV文件路径
- `get_csv_index_info(csv_path)` - 获取当前视频在match中的位置信息

### 2. 视频切换功能

**UI按钮**:
- `<< PrevVid` - 切换到上一个视频
- `NextVid >>` - 切换到下一个视频

**快捷键**:
- `Ctrl + ←` - 切换到上一个视频
- `Ctrl + →` - 切换到下一个视频

**功能说明**:
- 切换视频时会自动保存当前标注（如果有修改）
- 自动加载新视频的轨迹数据
- 自动运行Phase 1检测生成候选事件
- 自动跳转到第一个检测到的事件帧

### 3. Match/视频信息显示

**信息面板显示**:
```
MATCH/VIDEO
Match: match1
Video: 1_05_02
[1/11]
```

**启动信息显示**:
```
Match: match1 | Video: 1_05_02 [1/11]
```

显示当前是第几个视频（1）以及match中总共有多少个视频（11）。

### 4. UI布局调整

- 按钮面板从4行扩展到5行，增加了视频导航按钮
- 按钮字体稍微调小以适应更多按钮
- 快捷键面板更新，显示新的视频导航快捷键

## 使用示例

### 场景1: 标注整个match

```bash
python labeling_launcher.py --match_dir data/test/match1
```

在标注工具中，可以使用 `Ctrl+→` 快速切换到下一个视频，无需退出重新启动。

### 场景2: 单个视频标注

```bash
python labeling_launcher.py --csv data/test/match1/csv/1_05_02_ball.csv
```

在标注过程中发现需要查看前后视频时，可以使用：
- `Ctrl+←` 查看上一个视频
- `Ctrl+→` 查看下一个视频

## 技术细节

### 视频切换流程

1. **保存检查**: 如果当前视频有未保存的修改，提示用户保存
2. **查找新视频**: 根据CSV文件名查找对应的视频文件
3. **重新初始化**: 创建新的DataManager实例加载新视频和轨迹
4. **状态重置**: 重置当前帧、事件索引等状态
5. **运动学计算**: 重新计算速度、加速度等运动学特征
6. **自动检测**: 运行Phase 1检测器生成候选事件
7. **更新显示**: 刷新UI显示新视频内容

### 文件路径处理

系统会自动处理以下CSV目录结构：
- `data/test/match1/csv/` - 原始CSV文件
- `data/test/match1/corrected_csv/` - 修正后的CSV文件

对应的视频目录：
- `data/test/match1/video/` - 视频文件

### Match名称识别

从文件路径中自动提取match名称，支持以下格式：
- `data/test/match1/...` → `match1`
- `data/train/match10/...` → `match10`

## 注意事项

1. **自动保存**: 切换视频前会提示保存当前修改，建议及时保存
2. **内存使用**: 切换视频会释放旧视频的内存并加载新视频
3. **标注延续**: 每个视频的标注独立保存，不会相互影响
4. **边界处理**: 在第一个/最后一个视频时，导航按钮会提示已到达边界

## 快捷键总览

### 帧导航
- `←` / `A` - 上一帧
- `→` / `D` - 下一帧
- `↑` / `W` - 上一个事件
- `↓` - 下一个事件
- `Home` - 第一帧
- `End` - 最后一帧
- `PageUp` - 后退30帧
- `PageDown` - 前进30帧

### 视频导航 (NEW)
- `Ctrl + ←` - 上一个视频
- `Ctrl + →` - 下一个视频

### 编辑
- `Y` - 确认事件
- `Delete` - 删除事件
- `L` - 设置为落地
- `H` - 设置为击打
- `O` - 设置为出画
- `N` - 添加新事件

### 系统
- `S` / `Ctrl+S` - 保存
- `Q` / `Esc` - 退出
